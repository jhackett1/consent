# Migration `20201206132712-add-membershipmodel`

This migration has been generated by Jaye Hackett at 12/6/2020, 1:27:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "User" DROP CONSTRAINT "User_team_id_fkey"

ALTER TABLE "User" DROP COLUMN "team_id"

CREATE TABLE "Membership" (
    "admin" BOOLEAN NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "user_id" INTEGER NOT NULL,
    "team_id" INTEGER NOT NULL,

    PRIMARY KEY ("user_id","team_id")
)

ALTER TABLE "Membership" ADD FOREIGN KEY("user_id")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Membership" ADD FOREIGN KEY("team_id")REFERENCES "Team"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201205163455-add-picture-to-user..20201206132712-add-membershipmodel
--- datamodel.dml
+++ datamodel.dml
@@ -3,30 +3,40 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Team {
   id Int @id @default(autoincrement())
   name String?
   created_at DateTime @default(now())
   updated_at DateTime @updatedAt
-  users User[]
+  users Membership[]
   projects Project[]
 }
+model Membership {
+    admin Boolean
+    created_at DateTime @default(now())
+    updated_at DateTime @updatedAt
+    user_id Int
+    user User @relation(fields: [user_id], references: [id])
+    team_id Int
+    team Team @relation(fields: [team_id], references: [id])
+    @@id([user_id, team_id])
+}
+
 model User {
   id Int @id @default(autoincrement())
   name String?
   email String @unique
   password_digest String?
   picture String?
   created_at DateTime @default(now())
   updated_at DateTime @updatedAt
-  team_id Int
-  team Team @relation(fields: [team_id], references: [id])
+  teams Membership[]  
 }
 model Project {
   id Int @id @default(autoincrement())
```


